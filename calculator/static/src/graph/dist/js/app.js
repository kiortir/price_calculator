(function(e){function t(t){for(var r,c,s=t[0],i=t[1],l=t[2],d=0,f=[];d<s.length;d++)c=s[d],Object.prototype.hasOwnProperty.call(n,c)&&n[c]&&f.push(n[c][0]),n[c]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);u&&u(t);while(f.length)f.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],r=!0,s=1;s<a.length;s++){var i=a[s];0!==n[i]&&(r=!1)}r&&(o.splice(t--,1),e=c(c.s=a[0]))}return e}var r={},n={app:0},o=[];function c(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,c),a.l=!0,a.exports}c.m=e,c.c=r,c.d=function(e,t,a){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(c.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(a,r,function(t){return e[t]}.bind(null,r));return a},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/static/src/graph/dist/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],i=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=i;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d"),a("ac1f"),a("1276"),a("498a");var r=a("f2bf"),n={class:"mt-3"},o={class:"qz-block"},c=Object(r["createElementVNode"])("div",{class:"h3"},"Кварцевый агломерат",-1),s={class:"mb-3"},i=Object(r["createElementVNode"])("label",{for:"qz_spec",class:"form-label"},"Число мастеров",-1),l={id:"chart",class:"apex"},u={class:"ac-block"},d=Object(r["createElementVNode"])("div",{class:"h3"},"Акриловый камень",-1),f={class:"mb-3"},p=Object(r["createElementVNode"])("label",{for:"ac_spec",class:"form-label"},"Число мастеров",-1),h={id:"chart",class:"apex"};function m(e,t,a,m,b,v){var y=Object(r["resolveComponent"])("apexchart");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",n,[Object(r["createElementVNode"])("div",o,[c,Object(r["createElementVNode"])("div",s,[i,Object(r["withDirectives"])(Object(r["createElementVNode"])("input",{type:"number",class:"form-control",id:"qz_spec","onUpdate:modelValue":t[0]||(t[0]=function(e){return b.qz_specialists=e}),onChange:t[1]||(t[1]=function(){return v.setQzData&&v.setQzData.apply(v,arguments)})},null,544),[[r["vModelText"],b.qz_specialists,void 0,{number:!0}]])]),Object(r["createElementVNode"])("div",l,[Object(r["createVNode"])(y,{ref:"realtimeQzChart",height:600,options:b.chartOptions,series:b.series,onClick:v.clickHandler},null,8,["options","series","onClick"])])]),Object(r["createElementVNode"])("div",u,[d,Object(r["createElementVNode"])("div",f,[p,Object(r["withDirectives"])(Object(r["createElementVNode"])("input",{type:"number",class:"form-control",id:"ac_spec","onUpdate:modelValue":t[2]||(t[2]=function(e){return b.acryl_specialists=e}),onChange:t[3]||(t[3]=function(){return v.setAcData&&v.setAcData.apply(v,arguments)})},null,544),[[r["vModelText"],b.acryl_specialists,void 0,{number:!0}]])]),Object(r["createElementVNode"])("div",h,[Object(r["createVNode"])(y,{ref:"realtimeAcChart",height:600,options:b.chartOptions,series:b.series,onClick:v.clickHandler},null,8,["options","series","onClick"])])])])}var b=a("b85c"),v=a("2909"),y=a("1da1");a("96cf"),a("b0c0"),a("d3b7"),a("159b"),a("a9e3"),a("5319"),a("4e82"),a("3ca3"),a("ddb0"),a("99af"),a("caad"),a("2532"),a("d81d"),a("820e");Date.prototype.addDays=function(e){var t=new Date(this.valueOf()).getTime();return new Date(t+864e5*e)};var g={name:"app",data:function(){return{dealdata:[],dayoffs:[],status:null,pollInterval:null,qz_specialists:9,acryl_specialists:7,series:[],chartOptions:{noData:{text:"Загрузка..."},chart:{locales:[{name:"ru",options:{months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],shortMonths:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],days:["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],shortDays:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],toolbar:{exportToSVG:"Сохранить как SVG",exportToPNG:"Сохранить как  PNG",menu:"Меню",selection:"Выбранная область",selectionZoom:"Приблизить выбранную область",zoomIn:"Приблизить",zoomOut:"Отдалить",pan:"Панорамировать",reset:"Сбросить зум"}}}],type:"rangeBar",defaultLocale:"ru"},plotOptions:{bar:{horizontal:!0,barHeight:"50%",rangeBarGroupRows:!0}},colors:["#008FFB","#00E396","#FEB019","#FF4560","#775DD0","#3F51B5","#546E7A","#D4526E","#8D5B4C","#F86624","#D7263D","#1B998B","#2E294E","#F46036","#E2C044"],fill:{type:"solid"},tooltip:{enabled:!0,y:{formatter:function(e,t){var a=t.seriesIndex,r=t.w;return"Дата заключения: ".concat(new Date(r.config.series[a].data[0].contract_start_date).toLocaleDateString())},title:{formatter:function(e){return e}}}},annotations:{xaxis:[{x:(new Date).getTime(),strokeDashArray:0,borderColor:"#ff0000"}]},dataLabels:{enabled:!0,formatter:function(e,t){var a=t.seriesIndex,r=t.w;return r.config.series[a].name},textAnchor:"middle",style:{fontSize:"0.6em"},distributed:!1,offsetX:0,offsetY:0},xaxis:{type:"datetime"},legend:{show:!1},grid:{xaxis:{lines:{show:!0}}}}}},methods:{addBusyDays:function(e,t){for(var a=0;a<t;a++)e=e.addDays(1),this.isDayoff(e)&&t++;return e},deserializeDayoffs:function(e){var t=[];return e.data.months.forEach((function(a){a.days.split(",").forEach((function(r){t.push(Date.UTC(e.data.year,a.month-1,Number(r.replace(/\D/g,""))))}))})),t},getLeads:function(){var e=this;return Object(y["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",e.axios.post("/amo/leads").then((function(t){var a=t.data.leads.sort((function(e,t){return e.contract_start_date-t.contract_start_date})),r=[],n=[];a.forEach((function(e){"Акрил"==e.material?n.push(e):r.push(e)})),e.dealdata={qz:r,ac:n}})));case 1:case"end":return t.stop()}}),t)})))()},getDayoffs:function(){var e=this;return Object(y["a"])(regeneratorRuntime.mark((function t(){var a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=function(){return e.axios.post("/pricelist/prox/",{url:"http://xmlcalendar.ru/data/ru/".concat((new Date).getFullYear()-1,"/calendar.json")}).then((function(t){return e.deserializeDayoffs(t)}))},r=function(){return e.axios.post("/pricelist/prox/",{url:"http://xmlcalendar.ru/data/ru/".concat((new Date).getFullYear()+1,"/calendar.json")}).then((function(t){return e.deserializeDayoffs(t)}))},n=function(){return e.axios.post("/pricelist/prox/",{url:"http://xmlcalendar.ru/data/ru/".concat((new Date).getFullYear(),"/calendar.json")}).then((function(t){return e.deserializeDayoffs(t)}))},t.abrupt("return",Promise.all([a(),r(),n()]).then((function(t){e.dayoffs=[].concat.apply([],Object(v["a"])(t))})));case 4:case"end":return t.stop()}}),t)})))()},clickHandler:function(e,t,a){e.ctrlKey&&window.open("https://unirock.amocrm.ru/leads/detail/"+a.config.series[a.seriesIndex].data[0].lead)},isDayoff:function(e){return e instanceof Date&&(e=e.getTime()),0!=this.dayoffs.length&&this.dayoffs.includes(e)},firstToFinish:function(e){var t=0,a=1/0;for(var r in e)e[r]<a&&(a=e[r],t=r);return{index:t,value:a}},setQzData:function(){var e=this;return Object(y["a"])(regeneratorRuntime.mark((function t(){var a,r,n,o,c,s,i,l,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=[],r=Object(v["a"])(Array(e.qz_specialists)).map((function(){return 0})),n=Object(b["a"])(e.dealdata.qz);try{for(n.s();!(o=n.n()).done;)c=o.value,s=1e3*(c.contract_start_date+10800),i=e.firstToFinish(r),l=s>i.value?s:i.value,u=e.addBusyDays(new Date(l),c.work_duration).getTime(),a.push({name:c.contract_number,data:[{lead:c.lead_id,contract_start_date:s,x:"Мастер ".concat(i.index),y:[l,u]}]}),r[i.index]=u}catch(d){n.e(d)}finally{n.f()}e.$refs.realtimeQzChart.updateSeries(a);case 5:case"end":return t.stop()}}),t)})))()},setAcData:function(){var e=this;return Object(y["a"])(regeneratorRuntime.mark((function t(){var a,r,n,o,c,s,i,l,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=[],r=Object(v["a"])(Array(e.acryl_specialists)).map((function(){return 0})),n=Object(b["a"])(e.dealdata.ac);try{for(n.s();!(o=n.n()).done;)c=o.value,s=1e3*(c.contract_start_date+10800),i=e.firstToFinish(r),l=s>i.value?s:i.value,u=e.addBusyDays(new Date(l),c.work_duration).getTime(),a.push({name:c.contract_number,data:[{lead:c.lead_id,contract_start_date:s,x:"Мастер ".concat(i.index),y:[l,u]}]}),r[i.index]=u}catch(d){n.e(d)}finally{n.f()}e.$refs.realtimeAcChart.updateSeries(a);case 5:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;Promise.allSettled([this.getLeads(),this.getDayoffs()]).then((function(){Promise.all([e.setQzData(),e.setAcData()])}))}},x=a("6b0d"),D=a.n(x);const O=D()(g,[["render",m]]);var w=O,j=a("bc3a"),_=a.n(j),k=a("130e"),z=a("ae27"),E=a.n(z);function V(e){var t=null;if(document.cookie&&""!==document.cookie)for(var a=document.cookie.split(";"),r=0;r<a.length;r++){var n=a[r].trim();if(n.substring(0,e.length+1)===e+"="){t=decodeURIComponent(n.substring(e.length+1));break}}return t}var C=V("csrftoken");_.a.defaults.headers.common={"X-CSRFToken":C};var N=Object(r["createApp"])(w);N.use(E.a),N.use(k["a"],_.a),N.mount("#app")}});